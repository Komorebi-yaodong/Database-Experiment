-- --------------------------------------------------------
-- 主机:                           127.0.0.1
-- 服务器版本:                        8.0.29 - MySQL Community Server - GPL
-- 服务器操作系统:                      Win64
-- HeidiSQL 版本:                  12.1.0.6537
-- --------------------------------------------------------

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;


-- 导出 dbe3 的数据库结构
DROP DATABASE IF EXISTS `dbe3`;
CREATE DATABASE IF NOT EXISTS `dbe3` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
USE `dbe3`;

-- 导出  表 dbe3.books 结构
DROP TABLE IF EXISTS `books`;
CREATE TABLE IF NOT EXISTS `books` (
  `ISBN` varchar(13) NOT NULL,
  `book_name` varchar(100) NOT NULL,
  `total` int NOT NULL,
  `current` int NOT NULL,
  `author_name` varchar(50) NOT NULL,
  `classification` bigint NOT NULL,
  PRIMARY KEY (`ISBN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- 正在导出表  dbe3.books 的数据：~104 rows (大约)
INSERT INTO `books` (`ISBN`, `book_name`, `total`, `current`, `author_name`, `classification`) VALUES
	('978701004700', '安全web', 2, 0, '徐梓洋', 8),
	('9787010104782', '《敦煌南朝写本书法研究》', 175, 175, '王菡薇', 8),
	('9787010105017', '《邓小平南方谈话真情实录-记录人的记述》', 40, 40, '吴松营', 11),
	('9787100017565', '新书--汉译名--理想国', 74, 74, '柏拉图', 2),
	('9787100085533', '《中国近百年史》', 180, 179, '陈恭禄', 11),
	('9787106030780', '《敞开的门-中美现代电影剧作理论与技巧》', 160, 160, '许还山/罗雪莹', 10),
	('9787108050434', '俗世奇人-贰', 113, 113, '冯骥才', 9),
	('9787108052872', '津味儿', 168, 168, '赵永强', 9),
	('9787108053565', '《永恒的日记-每一天的音乐》', 245, 245, '[英] 诺曼·莱布雷希特 著，盛韵 译', 10),
	('9787108054401', '长篇小说:青年', 212, 212, '[日] 森鸥外 著，许时嘉 译', 9),
	('9787200106626', '《世界美术名作二十讲》', 210, 210, '傅雷', 7),
	('9787200109603', '《大家小书-大家写给大家看的书:民族文话》', 220, 220, '郑振铎', 7),
	('9787213069666', '《季羡林谈人生-唯一亲定自选集-精装珍藏版》', 235, 235, '季羡林', 7),
	('9787213075537', '《沉雪》', 20, 19, '李晶/李盈', 9),
	('9787213097577', '《李欣频的文案课》', 100, 100, '李欣频著', 7),
	('9787220102370', '《On Liberty-论自由-英文》', 290, 290, '约翰.斯图亚特.密尔', 2),
	('9787220103803', '《解除限速》', 120, 120, '[美] 劳伦斯·布洛克 著，张明 译', 9),
	('9787220104466', '许地山小全集:落花生', 179, 179, '许地山', 9),
	('9787220104541', '别让拖延毁了你的人生', 300, 300, '张乐', 7),
	('9787221083906', '中国历代名全译丛书(修订版):人物志全译', 158, 158, '[魏] 刘劭 ，马骏骐，朱建华 注', 11),
	('9787221083920', '中国历代名全译丛书(修订版):六朝文絜全译', 165, 165, '[清] 许梿 选编， 骆礼刚 译', 11),
	('9787229065416', '《纽伦堡来信:爱与正义的亲密档案》', 140, 140, '[美] 克里斯多夫·多德 等著， 周楠/李静 译', 9),
	('9787229125172', '《上锁的房间》', 60, 60, '劳拉.金', 9),
	('9787305078095', '《徐渭》', 170, 170, '丁家桐', 7),
	('9787305111341', '《爱情是一盘自制卡带》', 200, 200, '[美]谢菲尔德 著，冯倩珠 译', 9),
	('9787305154249', '《东鸣西应记》', 225, 225, '王鼎钧', 9),
	('9787506384209', '户外生存系列:野外攀爬游走技能', 157, 157, '艾米', 7),
	('9787506385831', '《老人与海》', 240, 240, '海明威', 9),
	('9787507546095', '《瞧.这个人-尼采自传》', 55, 55, '[德]弗里德里希.威廉.尼采 著,黄敬甫/李柳明 译', 9),
	('9787507831542', '《中国古代生物学》', 165, 165, '汪子春', 15),
	('9787510047169', '《怅望山河》', 115, 115, '朱幼棣', 9),
	('9787510463433', '我们内心的冲突', 102, 102, '(美)卡伦·霍妮', 3),
	('9787511018106', '《拉封丹寓言》', 205, 205, '[法] 拉·封丹 著，[法] 布特·德·蒙维 绘', 9),
	('9787511023414', '男女有别', 102, 102, '渡边淳一', 9),
	('9787511023421', '1984', 91, 91, '(英)乔治·奥威尔著', 9),
	('9787511024282', '阿Q正传', 80, 80, '鲁迅', 9),
	('9787511360557', '《寂静的春天》', 255, 255, '蕾切尔.卡森', 9),
	('9787511373021', '《社会学:原来这么有趣有用》', 150, 150, '宿文渊', 3),
	('9787511378989', '《我这一辈子:老舍中短篇小说集》', 95, 95, '老舍', 9),
	('9787512714007', '《奇妙的人体》', 45, 45, '[美] 雪莉·阿姆瑟尔 著，刘晓晨 译', 15),
	('9787513324069', '《家在海的那一边》', 265, 265, '蒋晓云', 9),
	('9787513917483', '鲁迅作品--野草', 172, 172, '鲁迅', 9),
	('9787513926508', '《自卑与超越》', 155, 154, '[奥] 阿尔弗雷德·阿德勒 著，陈玢 译', 9),
	('9787514350159', '三遂平妖传.归莲梦', 201, 201, '罗贯中', 9),
	('9787514364262', '庐隐文学精品选-现代文学精品集', 151, 151, '庐隐', 9),
	('9787514612813', '《托尼诺成长记》', 75, 74, '[意大利] 法比奥·通巴利 著，王干卿 译', 9),
	('9787514613346', '古典推理文库:菲尔博士率众前来', 223, 223, '卡尔　著', 9),
	('9787516831953', '《一种人生观》', 135, 135, '冯友兰', 9),
	('9787516909447', '拿破仑传', 25, 25, '埃米尔.路德维希', 11),
	('9787519018603', '《人间词话》', 260, 259, '王国维', 10),
	('9787532147434', '《克雷洛夫寓言-世界文学名著青少版.经典名著-99》', 195, 195, '（俄）克雷洛夫　著，王梅　改写', 9),
	('9787532162765', '金链汉子之歌', 46, 46, '曹寇', 9),
	('9787532164615', '禅宗故事', 186, 186, '易中天', 2),
	('9787532954742', '岛屿之书', 60, 60, '[英] 艾米·利普特罗特 ，高天航 译', 9),
	('9787533949037', '他们眼望上苍', 53, 52, '佐拉.尼尔.赫斯顿', 9),
	('9787534050893', '中国异闻录:2:2', 245, 245, '桐木著', 9),
	('9787535494184', '《远行.与异文明的初恋-冯骥才欧游手札-欧游手札.全彩图文版》', 275, 275, '冯骥才', 7),
	('9787536070554', '远大前程-全译本', 58, 58, '[英国] 查尔斯·狄更斯 著，金长蔚 译', 9),
	('9787536070615', '说史记-新史记', 69, 69, '杨早', 10),
	('9787538455601', '《动物世界-我的第一套百科全书》', 185, 185, '青少科普编委会', 21),
	('9787538751062', '《城南旧事》', 85, 85, '林海音', 9),
	('9787539289380', '名家.名译 神曲', 234, 234, '但丁', 10),
	('9787539296456', '洞察人性', 289, 289, '(美)阿尔弗雷德·阿德勒著', 3),
	('9787539655062', '猎人笔记', 179, 179, '(俄)屠格涅夫著', 7),
	('9787540245368', '《罗生门》', 30, 30, '[日] 芥川龙之介 著，高慧勤 译', 9),
	('9787540772086', '城堡-全译本', 47, 47, '[奥地利] 弗朗茨·卡夫卡 著，邹文华 译', 9),
	('9787541143670', '菩提花', 95, 95, '[德] 赫尔曼·黑塞 ，张佩芬 译', 9),
	('9787542858580', '交通工具-它们是如何工作的', 32, 32, '斯科特.麦克尼尔', 7),
	('9787544291170', '百年孤独', 88, 87, '[哥伦比亚]加西亚·马尔克斯 ', 9),
	('9787545144086', '屠格涅夫中短篇小说选', 36, 36, '[俄] 屠格涅夫 著，沈念驹 译', 9),
	('9787545526868', '我爱干净', 137, 137, '文心', 9),
	('9787545526899', '我不哭', 123, 123, '文心', 9),
	('9787545526929', '我不怕', 130, 130, '文心', 9),
	('9787545527223', '《狼烟北平》', 270, 270, '都梁', 9),
	('9787545527674', '《林徽因传:水墨清华,刹那芳华》', 285, 285, '苏尹', 9),
	('9787546368573', '培根随笔', 256, 256, '[英] 培根 著，张璘 译', 2),
	('9787547237939', '经典国学读本:论语(附圣迹图)', 278, 278, '[春秋]孔丘', 7),
	('9787548444145', '《小王子》', 65, 65, '[法] 安托万·德·圣埃克苏佩里 著', 9),
	('9787550021822', '宫中记-北落师门', 39, 39, '侧侧轻寒', 10),
	('9787550022034', '《两个她的奇幻之旅》', 280, 280, '[英]菲德拉.帕特里克 著，吴超 译', 9),
	('9787550241077', '云南味道', 124, 124, '张家荣', 3),
	('9787550246256', '《乌合之众:大众心理研究》', 90, 90, '[法]古斯塔夫.勒庞 著，陈竹兰 译', 2),
	('9787550277014', '《WHAT IF那些古怪又让人忧心的问题(珍藏版)》', 250, 249, '[美] 兰道尔·门罗 著，朱君玺 译', 9),
	('9787550291720', '《随园食单》', 125, 125, '(清)袁枚著', 9),
	('9787553443751', '世界文学名著典藏·全译本:爱丽丝漫游奇境', 267, 267, '[英] 刘易斯·卡罗尔 著，吴钧陶 译', 9),
	('9787553791463', '《人间失格（全新修订版）》', 25, 25, '[日]太宰治 著,烨伊 译', 9),
	('9787555227137', '刚果之行', 190, 189, '(法)安德烈·纪德著', 9),
	('9787555229032', '鬼吹灯8巫峡棺山', 146, 146, '天下霸唱', 9),
	('9787555254966', '留白', 81, 80, '渡边淳一', 9),
	('9787556824601', '迦陵论词绝句五十首', 116, 116, '叶嘉莹', 10),
	('9787559604132', '今生要云的100个中国5A景区', 67, 66, '郝娟菡', 3),
	('9787559610058', '《瓦尔登湖》', 145, 144, '[美]亨利·戴维·梭罗著，肖箴 译', 2),
	('9787559612656', '《夏日走过山间》', 35, 35, '[美] 约翰·缪尔 著，林如海/李绒 译', 9),
	('9787559618573', '《挂枝儿.山歌.夹竹桃:民歌三种》', 80, 80, '[明]冯梦龙', 10),
	('9787559640895', '《于丹:汉字之美》', 130, 130, '于丹', 8),
	('9787560576145', '《变形记》', 230, 230, '(奥)卡夫卡著', 9),
	('9787569915822', '《官墙里:一个人的乡村与都市》', 50, 49, '阎海军', 9),
	('9787569919110', '呼兰河传', 193, 192, '萧红', 9),
	('9787802567368', '睡蛇的伤口', 135, 134, '徐小斌 著', 9),
	('9787807368472', '《唐摭言》', 110, 110, '[五代]王定保 著，黄寿成 点校', 9),
	('9787807414391', '《老舍小说精汇－断魂枪集》', 105, 103, '老舍', 9),
	('9787807680567', '《我愿意改变》', 215, 214, '克里斯托夫.安德烈', 9);

-- 导出  表 dbe3.borrows 结构
DROP TABLE IF EXISTS `borrows`;
CREATE TABLE IF NOT EXISTS `borrows` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `sno` varchar(8) NOT NULL,
  `isbn` varchar(13) NOT NULL,
  `borrow_date` datetime NOT NULL,
  `return_date` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_Borrows_Students` (`sno`),
  KEY `fk_Borrows_Books` (`isbn`),
  CONSTRAINT `fk_Borrows_Books` FOREIGN KEY (`isbn`) REFERENCES `books` (`ISBN`) ON DELETE CASCADE,
  CONSTRAINT `fk_Borrows_Students` FOREIGN KEY (`sno`) REFERENCES `students` (`Sno`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=278 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- 正在导出表  dbe3.borrows 的数据：~17 rows (大约)
INSERT INTO `borrows` (`id`, `sno`, `isbn`, `borrow_date`, `return_date`) VALUES
	(1, '20370001', '9787569919110', '2022-02-15 08:00:00', NULL),
	(2, '20370001', '9787559610058', '2022-02-15 09:00:00', NULL),
	(3, '20370001', '9787559604132', '2022-12-13 11:12:57', NULL),
	(4, '20370018', '9787569915822', '2022-12-13 11:12:57', '2022-12-13 11:12:57'),
	(5, '20370011', '9787807414391', '2022-12-13 11:12:57', '2022-12-13 11:12:57'),
	(6, '20370023', '9787550277014', '2022-12-13 11:12:57', NULL),
	(8, '20370021', '9787555254966', '2022-12-13 11:12:57', NULL),
	(9, '20370031', '9787533949037', '2022-12-13 11:12:57', NULL),
	(11, '20370008', '9787807414391', '2022-12-13 11:12:57', NULL),
	(12, '20370004', '9787519018603', '2022-12-13 11:12:57', '2022-12-13 11:12:57'),
	(13, '20370016', '9787513926508', '2022-12-13 11:12:57', NULL),
	(14, '20370009', '9787802567368', '2022-12-13 11:12:57', '2022-12-13 11:12:57'),
	(15, '20370017', '9787100085533', '2022-12-13 11:12:57', NULL),
	(16, '20370014', '9787213075537', '2022-12-13 11:12:57', NULL),
	(17, '20370023', '9787514612813', '2022-12-13 11:12:57', NULL),
	(18, '20370030', '9787555227137', '2022-12-13 11:12:57', NULL);

-- 导出  表 dbe3.classifications 结构
DROP TABLE IF EXISTS `classifications`;
CREATE TABLE IF NOT EXISTS `classifications` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `classification` varchar(30) DEFAULT NULL,
  `location` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=23 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- 正在导出表  dbe3.classifications 的数据：~22 rows (大约)
INSERT INTO `classifications` (`id`, `classification`, `location`) VALUES
	(1, '马克思主义', 'A区'),
	(2, '哲学', 'B区'),
	(3, '社会科学总论', 'C区'),
	(4, '政法', 'D区'),
	(5, '军事', 'E区'),
	(6, '经济', 'F区'),
	(7, '文化', 'G区'),
	(8, '语言', 'H区'),
	(9, '文学', 'I区'),
	(10, '艺术', 'J区'),
	(11, '历史', 'K区'),
	(12, '自然科学总论', 'N区'),
	(13, '数理科学和化学', 'O区'),
	(14, '天文学', 'P区'),
	(15, '生物科学', 'Q区'),
	(16, '医药', 'R区'),
	(17, '农业科学', 'S区'),
	(18, '工业技术', 'T区'),
	(19, '交通运输', 'U区'),
	(20, '航空航天', 'V区'),
	(21, '安全科学', 'X区'),
	(22, '综合性图书', 'Z区');

-- 导出  表 dbe3.notion 结构
DROP TABLE IF EXISTS `notion`;
CREATE TABLE IF NOT EXISTS `notion` (
  `notion` varchar(255) NOT NULL,
  PRIMARY KEY (`notion`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- 正在导出表  dbe3.notion 的数据：~1 rows (大约)
INSERT INTO `notion` (`notion`) VALUES
	('hello world');

-- 导出  表 dbe3.students 结构
DROP TABLE IF EXISTS `students`;
CREATE TABLE IF NOT EXISTS `students` (
  `Sno` varchar(8) NOT NULL,
  `name` varchar(100) NOT NULL,
  `password_hash` varchar(64) NOT NULL,
  `telephone` varchar(11) NOT NULL,
  `hold` int DEFAULT '0',
  `ROLE` int DEFAULT '0',
  PRIMARY KEY (`Sno`),
  CONSTRAINT `students_chk_1` CHECK ((`hold` <= 10))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- 正在导出表  dbe3.students 的数据：~30 rows (大约)
INSERT INTO `students` (`Sno`, `name`, `password_hash`, `telephone`, `hold`, `ROLE`) VALUES
	('19375218', 'xzy', 'd86ad36821fa962f47b64b2f41e9d9bb', '00000000005', 0, 1),
	('19376213', 'sz', '7dabf5c198b0bab2eaa42bb03a113e55', '00000000004', 0, 1),
	('20231213', 'gxy', '0e783a89d5f0898b028ff23da5f087d6', '00000000006', 0, 1),
	('20370001', '测试用户', '098f6bcd4621d373cade4e832627b4f6', '12345678912', 3, 0),
	('20370004', '赵鹤茂', '5d8af9d97a8969e5fb05e5c1caa3b499', '18657264789', 1, 0),
	('20370008', '乐木霆', '593fa33952b888e342b6ea8797ade4b3', '17524893924', 1, 0),
	('20370009', '孙致霖', 'ee19e453829326eb7192bf50037b4269', '18192386071', 1, 0),
	('20370011', '李明轩', 'dcc77169f507c60b9e778c37a2738560', '13327502754', 1, 0),
	('20370014', '竹彦昌', 'a529a8a1b993705cfdf6f9b48b1baccd', '18869331415', 1, 0),
	('20370016', '颜如玉', '937c02cd25af6c8c225d06b14876430b', '19846725976', 1, 0),
	('20370017', '玉文翰', 'ed829cdb0ca01e47382ff8ab8c875119', '13224675553', 1, 0),
	('20370018', '方君彦', '77a30c031136f1d47375631c0a9865bb', '18803386523', 1, 0),
	('20370021', '晓星尘', '9cb19f353255a6b9b50253a1e6c9c870', '18749501773', 1, 0),
	('20370023', '李昊明', '7d012fd69545d081459d8faac9291f21', '18447898786', 2, 0),
	('20370026', '柳钰婉', '6eb4f98d02c88add53d3758db8572664', '15195165664', 0, 0),
	('20370027', '柳雅绚', '621baa35ab05dc1136101265d08509e5', '13286857844', 0, 0),
	('20370028', '孙莹凝', 'd726760b0467b77803d6d1f3585deb6e', '15231269690', 0, 0),
	('20370029', '张施芸', 'eb25d21e8a4d7dc52947b61ab26a2694', '18083991177', 0, 0),
	('20370030', '刘荷怡', '7006786cf5928a706bb85a748c64cc88', '14767474179', 1, 0),
	('20370031', '周婉沁', '47ccc82abac13739393a94ddb1abfce7', '17753676848', 1, 0),
	('20370032', '王丹曼', 'da552355df18d706b1cb44aad2699661', '18296724063', 0, 0),
	('20370033', '王漫菲', 'e45e98a6e628ad018d701e53dd696fb2', '13520982030', 0, 0),
	('20370034', '王杉娜', '57d44312047f5f7be000f66286b02cd1', '13857701863', 0, 0),
	('20373040', 'sp', '1952a01898073d1e561b9b4f2e42cbd7', '00000000004', 0, 1),
	('20373108', 'zyd', 'ba157d2ecdcaeac516b27cf02bf45e59', '00000000001', 0, 1),
	('20373812', 'zyl', '3a79f9e97bb9c416ceefb40943001e5d', '00000000002', 0, 1),
	('20373941', 'lx', '8037ccea85006fee74f58f86edf1788e', '00000000003', 0, 1);

-- 导出  触发器 dbe3.holdDown 结构
DROP TRIGGER IF EXISTS `holdDown`;
SET @OLDTMP_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';
DELIMITER //
CREATE TRIGGER `holdDown` AFTER UPDATE ON `borrows` FOR EACH ROW BEGIN
	if(NEW.return_date IS NOT NULL) then
		UPDATE students
		SET students.hold = students.hold-1
		WHERE students.sno=NEW.sno;
		UPDATE books
		SET books.`current` = books.`current`+1
		WHERE books.ISBN = NEW.isbn;
	END if;
END//
DELIMITER ;
SET SQL_MODE=@OLDTMP_SQL_MODE;

-- 导出  触发器 dbe3.holdUp 结构
DROP TRIGGER IF EXISTS `holdUp`;
SET @OLDTMP_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';
DELIMITER //
CREATE TRIGGER `holdUp` AFTER INSERT ON `borrows` FOR EACH ROW BEGIN
	UPDATE students
	SET students.hold = students.hold+1
	WHERE students.sno=NEW.sno;
	UPDATE books
	SET books.`current` = books.`current`-1
	WHERE books.ISBN = NEW.isbn;
END//
DELIMITER ;
SET SQL_MODE=@OLDTMP_SQL_MODE;

/*!40103 SET TIME_ZONE=IFNULL(@OLD_TIME_ZONE, 'system') */;
/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 1) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40111 SET SQL_NOTES=IFNULL(@OLD_SQL_NOTES, 1) */;
